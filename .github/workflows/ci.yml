name: CI

# Build & test on push and pull-request for major platforms. This workflow
# intentionally does not enable the interactive integration tests by default.
# Integration tests are gated behind AXIDEV_IO_RUN_INTEGRATION_TESTS and should
# be executed via the manual `integration-tests` workflow when desired.
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # Ubuntu / x86_64
  build-linux-x64:
    name: Build and test on ubuntu-latest (x86_64)
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: ubuntu-latest
      arch: x64
      build-type: Release
      build-tests: true
      run-tests: true

  # # macOS / ARM64
  # build-macos-arm64:
  #   name: Build and test on macos-latest (arm64)
  #   uses: ./.github/workflows/build-reusable.yml
  #   with:
  #     os: macos-latest
  #     arch: arm64
  #     build-type: Release
  #     build-tests: true
  #     run-tests: true

  # Windows / x86_64
  build-windows-x64:
    name: Build and test on windows-latest (x86_64)
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: windows-latest
      arch: x64
      build-type: Release
      build-tests: true
      run-tests: true
